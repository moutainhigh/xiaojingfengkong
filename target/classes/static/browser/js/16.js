webpackJsonp([16],{"N9/9":function(e,t,a){var n=a("SRBs");"string"==typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);a("rjj0")("5b5c7310",n,!0)},SRBs:function(e,t,a){(e.exports=a("FZ+f")(!1)).push([e.i,"\n.main .right[data-v-69a594c9] {\n  float: right;\n  margin-right: 20px;\n}\n.main .right[data-v-69a594c9]:after {\n  clear: both;\n}\n.main .width[data-v-69a594c9] {\n  width: 300px;\n}\n",""])},gky7:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a("t5DY"),l=a("E4LH"),i={name:"notice-manage",data:function(){var e=this;return{example:"actNotice",tableHeight:500,noticeManage:{name:""},noticeManageTable:[],total:0,listQuery:{page:1,sizes:[10,20,30,40],size:10},searchParams:{name:"",page:0,size:10,fields:"*,act,createdBy,entityManager,noticeTemplate"},dialogAddData:!1,addForm:{name:"",delayType:"",delayTime:0,checkList:"",roleCode:"",noticeTemplate:{id:""},entityManager:{id:""},act:{id:""},canBeCancelled:0},multipleSelection:[],options:[{value:"SMS",label:"阿里云"},{value:"MESSAGE",label:"站内信"},{value:"WXWORK",label:"企业微信"},{value:"WXPUBLIC",label:"微信公众号"},{value:"EMAIL",label:"邮箱",disabled:!0},{value:"APP",label:"移动端",disabled:!0}],value:"SMS",optionVal:[],entityManagerVal:[],actVal:[],rules:{name:[{required:!0,message:"请输入通知名称",trigger:"blur"}],delayType:[{required:!0,message:"请选择通知类型",trigger:"change"}],delayTime:[{required:!0,trigger:"blur",validator:function(t,a,n){"DELAY"==e.addForm.delayType?Object(l.b)(a)?n():n(new Error("只能输入正整数且不能为空！")):(e.addForm.delayTime=0,n())}}],checkList:[{required:!0,message:"请勾选用户角色",trigger:"change"}],noticeTemplate:{id:[{required:!0,message:"请选择模板",trigger:"change"}]},entityManager:{id:[{required:!0,message:"请选择实体",trigger:"change"}]},act:{id:[{required:!0,message:"请选择行为",trigger:"change"}]}}}},computed:{timestampToTime:function(){return n.l},getButtons:function(){return n.g}},mounted:function(){var e=this.$refs.height.offsetHeight;this.tableHeight=e-63-128-30,this.getNoticeManageData(),this.getEntityManager(),this.selectChange()},methods:{onSubmit:function(){this.searchParams.name=this.noticeManage.name,this.getNoticeManageData()},onClear:function(){this.noticeManage.name="",this.searchParams.name=this.noticeManage.name,this.getNoticeManageData()},onAdd:function(){this.dialogAddData=!0},getNoticeManageData:function(){var e=this;Object(n.p)(this.example,Object(n.o)(this.searchParams,["name"])).then(function(t){console.log(t),e.noticeManageTable=t.data,e.total=t.total})},handleSizeChange:function(e){this.searchParams.size=e,this.getNoticeManageData()},handleCurrentChange:function(e){this.searchParams.page=e-1,this.getNoticeManageData()},closeDialog:function(e){var t=this;this.$confirm("此操作将关闭表单和清空表单的数据, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e(),t.resetForm()}).catch(function(){t.$message({type:"info",message:"已取消该操作"})})},cancelCreate:function(){var e=this;this.$confirm("此操作将关闭表单和清空表单的数据, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.dialogAddData=!1,e.resetForm()}).catch(function(){e.$message({type:"info",message:"已取消该操作"})})},createData:function(){var e=this;this.addForm.roleCode=this.addForm.checkList,this.$refs.addForm.validate(function(t){t?(Object(n.a)(e.example,Object(n.j)(e.addForm,["checkList"])).then(function(t){e.getNoticeManageData(),e.resetForm(),e.$notify({title:"成功",message:"新增通知成功！",type:"success",duration:2e3})}),e.dialogAddData=!1):e.$notify({title:"警告",message:"数据填写出错。",type:"warning"})})},resetForm:function(){this.$refs.addForm.resetFields()},delayType:function(e){return"IMMEDIATELY"===e.delayType?"立即执行":"DELAY"===e.delayType?"延时"+Object(n.k)(e.delayTime):void 0},handleSelectionChange:function(e){this.multipleSelection=e},onRemove:function(){var e=this;this.multipleSelection.forEach(function(t,a){Object(n.b)(e.example,{id:t.id}).then(function(t){a==e.multipleSelection.length-1&&(e.getNoticeManageData(),e.$notify({title:"成功",message:"通知删除成功",type:"success",duration:2e3}))})})},selectChange:function(){var e=this;Object(n.d)("noticeTemplate",{fields:"*",noticeChannel:this.value}).then(function(t){e.optionVal=t.data})},getEntityManager:function(){var e=this;Object(n.d)("entityManager",{fields:"*",managerGroup:"ADMIN"}).then(function(t){e.entityManagerVal=t.data})},selectEntityManager:function(e){var t=this;Object(n.d)("act",{fields:"*","entityManager.id":e}).then(function(e){t.actVal=e.data})},handleUpdate:function(e){var t=this;console.log(e),this.value=e.noticeTemplate.noticeChannel,this.addForm.name=e.name,this.addForm.delayType=e.delayType,this.addForm.delayTime=e.delayTime,this.addForm.checkList=e.roleCode,this.addForm.noticeTemplate.id=e.noticeTemplate.id,this.addForm.act.id=e.act.id,Object(n.h)("act",{fields:"*,entityManager",id:e.act.id}).then(function(e){console.log(e),t.addForm.entityManager.id=e.data.entityManager.id,t.selectEntityManager(e.data.entityManager.id)}),this.selectChange(),this.dialogAddData=!0}},watch:{addForm:{handler:function(e,t){"IMMEDIATELY"==e.delayType?this.addForm.canBeCancelled=0:this.addForm.canBeCancelled=1},deep:!0}}},o={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{ref:"height",staticClass:"main"},[a("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0,model:e.noticeManage}},[a("el-form-item",{attrs:{label:"通知名称"}},[a("el-input",{attrs:{placeholder:"请输入通知名称"},model:{value:e.noticeManage.name,callback:function(t){e.$set(e.noticeManage,"name",t)},expression:"noticeManage.name"}})],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:e.onSubmit}},[e._v("查询")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.onClear}},[e._v("清除")])],1),e._v(" "),a("el-form-item",{staticClass:"right"},[a("el-button",{attrs:{type:"success"},on:{click:e.onAdd}},[e._v("新增")]),e._v(" "),a("el-button",{attrs:{type:"warning"},on:{click:e.onRemove}},[e._v("删除")])],1)],1),e._v(" "),a("el-table",{ref:"noticeManageTable",staticStyle:{width:"100%"},attrs:{height:e.tableHeight,border:"",data:e.noticeManageTable,"tooltip-effect":"dark"},on:{"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection",width:"55"}}),e._v(" "),a("el-table-column",{attrs:{label:"通知名称",align:"center",prop:"name"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.name))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"通知创建人",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.createdBy.name))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"通知模板名称",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.noticeTemplate.name))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"通知延时类型",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(e.delayType(t.row)))])]}}])}),e._v(" "),a("el-table-column",{attrs:{align:"center",label:"通知角色"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.roleCode))])]}}])}),e._v(" "),a("el-table-column",{attrs:{align:"center",label:"该通知可取消"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.canBeCancelled?"是":"否"))])]}}])}),e._v(" "),a("el-table-column",{attrs:{align:"center",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{size:"small",icon:"el-icon-edit",type:"text"},on:{click:function(a){e.handleUpdate(t.row)}}},[e._v("编辑")])]}}])})],1),e._v(" "),a("el-pagination",{attrs:{background:"","current-page":e.listQuery.page,"page-sizes":e.listQuery.sizes,"page-size":e.listQuery.size,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}}),e._v(" "),a("el-dialog",{attrs:{title:"公告管理",width:"600px",visible:e.dialogAddData,"before-close":e.closeDialog},on:{"update:visible":function(t){e.dialogAddData=t}}},[a("el-form",{ref:"addForm",staticClass:"demo-form-inline",attrs:{rules:e.rules,model:e.addForm,"label-width":"120px"}},[a("el-form-item",{attrs:{label:"通知名称",prop:"name"}},[a("el-input",{staticClass:"width",attrs:{placeholder:"请输入通知名称"},model:{value:e.addForm.name,callback:function(t){e.$set(e.addForm,"name",t)},expression:"addForm.name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"通知延时类型",prop:"delayType"}},[a("el-select",{staticClass:"width",attrs:{placeholder:"请选择通知延时类型"},model:{value:e.addForm.delayType,callback:function(t){e.$set(e.addForm,"delayType",t)},expression:"addForm.delayType"}},[a("el-option",{attrs:{label:"立即执行",value:"IMMEDIATELY"}}),e._v(" "),a("el-option",{attrs:{label:"延时",value:"DELAY"}})],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"通知延时时间",prop:"delayTime"}},[a("el-input",{staticClass:"width",attrs:{placeholder:"选择延时类型必须输入。"},model:{value:e.addForm.delayTime,callback:function(t){e.$set(e.addForm,"delayTime",t)},expression:"addForm.delayTime"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"用户角色",prop:"checkList"}},[a("el-radio-group",{model:{value:e.addForm.checkList,callback:function(t){e.$set(e.addForm,"checkList",t)},expression:"addForm.checkList"}},[a("el-radio",{attrs:{label:"管理员"}},[e._v("管理员")]),e._v(" "),a("el-radio",{attrs:{label:"普通用户"}},[e._v("普通用户")])],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"模板类型",prop:"industryType"}},[a("el-select",{staticClass:"width",on:{change:e.selectChange},model:{value:e.value,callback:function(t){e.value=t},expression:"value"}},e._l(e.options,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value,disabled:e.disabled}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"选择模板",prop:"noticeTemplate.id"}},[a("el-select",{staticClass:"width",attrs:{filterable:"",placeholder:"请选择"},model:{value:e.addForm.noticeTemplate.id,callback:function(t){e.$set(e.addForm.noticeTemplate,"id",t)},expression:"addForm.noticeTemplate.id"}},e._l(e.optionVal,function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"选择实体",prop:"entityManager.id"}},[a("el-select",{staticClass:"width",attrs:{filterable:"",placeholder:"请选择"},on:{change:e.selectEntityManager},model:{value:e.addForm.entityManager.id,callback:function(t){e.$set(e.addForm.entityManager,"id",t)},expression:"addForm.entityManager.id"}},e._l(e.entityManagerVal,function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"选择行为",prop:"act.id"}},[a("el-select",{staticClass:"width",attrs:{filterable:"",placeholder:"请选择"},model:{value:e.addForm.act.id,callback:function(t){e.$set(e.addForm.act,"id",t)},expression:"addForm.act.id"}},e._l(e.actVal,function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}))],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.cancelCreate}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.createData}},[e._v("确 定")])],1)],1)],1)},staticRenderFns:[]};var r=a("VU/8")(i,o,!1,function(e){a("N9/9")},"data-v-69a594c9",null);t.default=r.exports}});