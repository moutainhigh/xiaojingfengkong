webpackJsonp([7],{"4ykh":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n("mvHQ"),l=n.n(i),a=n("t5DY"),o=(n("vMJZ"),{name:"index",props:["moduleData"],data:function(){return{example:"moduleManager",example2:"supplyAPI",dialogImageUrl:"",dialogVisible:!1,imgNum:"",detailId:"",files:[],params:{id:"",fields:"*,files"},tableHeight:500,tableData:[],multipleSelection:"",loadingInstance:"",enabledText:{true:"启用",false:"禁用"},enabledQuery:{},moduleRule:{name:[{required:!0,message:"请输入菜单名称",trigger:"blur"}]},moduleDetail:{name:"",description:"",uploadFiles:[]},total:0,listQuery:{page:"0",size:10,fields:"*"}}},computed:{timestampToTime:function(){return a.l}},mounted:function(){var e=this.$refs.height.offsetHeight;this.tableHeight=e-63-128-30},methods:{getMechanismDetail:function(){var e=this;""!=this.detailId&&(this.params.id=this.detailId.split("-")[0],this.files=[],Object(a.h)(this.example,Object(a.f)(this.params)).then(function(t){if(e.form=t.data,console.log(t.data),t.data.groupFiles){var n=e;t.data.groupFiles["创建"]&&t.data.groupFiles["创建"].forEach(function(e){e.fileSize>0&&n.files.push(e)}),t.data.groupFiles["编辑"]&&t.data.groupFiles["编辑"].forEach(function(e){e.fileSize>0&&n.files.push(e)}),e.files.forEach(function(e){e.url="http://"+e.url})}else e.files=[]}))},handleRemove:function(e,t){var n=this,i=this;i.files.forEach(function(t,n){t.id==e.id&&i.files.splice(n,1)}),e.id&&Object(a.b)("moduleManagerFile",{id:e.id}).then(function(e){n.$message({type:"success",message:"图片删除成功!"})})},handlePictureCardPreview:function(e){this.dialogImageUrl=e.url,this.dialogVisible=!0},beforeUpload:function(){},uploadSuccess:function(e){this.imgNum++,this.files.push(e.data);var t=this.files.length-1;this.files[t].url="http://"+this.files[t].url},onExceed:function(){this.$message.error("上传图片数量不能超过三张图片!")},enabledF:function(e,t){var n=this;this.enabledQuery={id:e,enabled:t},Object(a.c)(this.example2,this.enabledQuery).then(function(e){n.getUser(),n.$notify({title:"成功",message:n.enabledText[data]+"成功",type:"success",duration:2e3})})},updateDate:function(){var e=this;this.moduleDetail.id=this.moduleData.id,this.moduleDetail.uploadFiles=this.files;for(var t={},n=0;n<this.moduleDetail.uploadFiles.length;n++)if(this.moduleDetail.uploadFiles[n].id)this.moduleDetail.uploadFiles[n]={imgId:this.moduleDetail.uploadFiles[n].id};else{for(var i in this.moduleDetail.uploadFiles[n])"uid"!=i&&"status"!=i&&(t[i]=this.moduleDetail.uploadFiles[n][i]),"url"==i&&(t[i]=t[i].substr(7));this.moduleDetail.uploadFiles[n]=t}console.log(this.moduleDetail),this.$refs.moduleForm.validate(function(t){t&&Object(a.n)(e.example,Object(a.j)(e.moduleDetail,["selectedOptions"])).then(function(t){e.$notify({title:"成功",message:"更新成功",type:"success",duration:2e3})}).catch(function(e){console.log(e)})})},handleSizeChange:function(e){this.listQuery.size=e,this.getUser()},handleCurrentChange:function(e){this.listQuery.page=e-1,this.getUser()},getUser:function(){var e=this;Object(a.d)(this.example2,this.listQuery).then(function(t){e.tableData=t.data,e.total=t.total})},resetForm:function(e){this.dialogFlag=!1,this.$refs[e].resetFields()}},watch:{moduleData:function(e,t){this.getUser(),this.detailId=e.id+"-"+(new Date).valueOf(),this.getMechanismDetail(),this.moduleDetail={name:e.name,description:e.description,uploadFiles:[]}}}}),s={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{ref:"height",staticClass:"main",attrs:{id:"backgounduser"}},[n("el-container",[n("el-aside",{attrs:{width:"50%"}},[n("el-form",{ref:"moduleForm",staticStyle:{"margin-top":"50px","max-width":"462px"},attrs:{align:"left",rules:e.moduleRule,model:e.moduleDetail,"label-width":"150px"}},[n("el-form-item",{attrs:{label:"模块名称",prop:"name"}},[n("el-input",{model:{value:e.moduleDetail.name,callback:function(t){e.$set(e.moduleDetail,"name",t)},expression:"moduleDetail.name"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"模块描述",prop:"description"}},[n("el-input",{staticStyle:{width:"312px"},attrs:{type:"textarea",rows:6,"max-length":"100",placeholder:"最多输入100个字"},model:{value:e.moduleDetail.description,callback:function(t){e.$set(e.moduleDetail,"description",t)},expression:"moduleDetail.description"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"模块照片",prop:"uploadFiles"}},[n("el-upload",{ref:"upload",attrs:{action:"fileUpload","list-type":"picture-card",limit:3,"file-list":e.files,"on-exceed":e.onExceed,"before-upload":e.beforeUpload,"on-success":e.uploadSuccess,"on-preview":e.handlePictureCardPreview,"on-remove":e.handleRemove}},[n("i",{staticClass:"el-icon-plus"})]),e._v(" "),n("el-dialog",{attrs:{visible:e.dialogVisible},on:{"update:visible":function(t){e.dialogVisible=t}}},[n("img",{attrs:{width:"100%",src:e.dialogImageUrl,alt:""}})])],1),e._v(" "),n("el-form-item",[n("el-button",{attrs:{type:"primary"},on:{click:e.updateDate}},[e._v("确 定")]),e._v(" "),n("el-button",{on:{click:function(t){e.$emit("changeFlag")}}},[e._v("返 回")])],1)],1)],1),e._v(" "),n("el-main",[n("el-table",{attrs:{height:e.tableHeight,border:"",data:e.tableData},on:{"sort-change":function(e){}}},[n("el-table-column",{attrs:{width:"50",label:"排序",type:"index",align:"center"}}),e._v(" "),n("el-table-column",{attrs:{label:"接口名称",align:"center",prop:"name",width:"250"}}),e._v(" "),n("el-table-column",{attrs:{label:"接口时效（天）",align:"center",prop:"effectiveTime",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n            "+e._s((t.row.effectiveTime/86400).toFixed(2))+"\n          ")]}}])}),e._v(" "),n("el-table-column",{attrs:{label:"接口成本（元）",align:"center",prop:"price",width:"150"}}),e._v(" "),n("el-table-column",{attrs:{align:"center",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[1==t.row.enabled?n("el-button",{attrs:{size:"small",type:"warning"},on:{click:function(n){e.enabledF(t.row.id,!1)}}},[e._v("禁用")]):n("el-button",{attrs:{size:"small"},on:{click:function(n){e.enabledF(t.row.id,!0)}}},[e._v("启用")])]}}])})],1),e._v(" "),n("el-pagination",{attrs:{background:"","current-page":1,"page-sizes":[10,20,30,40],"page-size":10,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)],1)],1)},staticRenderFns:[]};var r=n("VU/8")(o,s,!1,function(e){n("a2D9")},"data-v-ef9a870e",null).exports,c=n("E4LH"),u={name:"index",data:function(){return{example:"moduleManager",editFlag:!1,imgsrc:"",voucherShow:!1,moduleData:"",tableHeight:500,ACTIVE:!0,tableData:[],dialogVisible:!1,dialogFlag:!1,dialogText:{true:"新增模块",false:"编辑模块"},openQuery:{id:"",enabled:""},closeQuery:{id:"",enabled:""},enabledText:{true:"启用",false:"禁用"},multipleSelection:[],updateTemp:{description:"",name:"",code:"",price:""},formInline:{page:"0",size:10,name:"",fields:"*,productionManagers,files"},total:0,listQuery:{page:"0",size:10,fields:"*,productionManagers,files"},updateRule:{name:[{required:!0,message:"请输入接口名称",trigger:"blur"}],code:[{required:!0,message:"请输入code",trigger:"blur"}],price:[{required:!0,validator:function(e,t,n){""===t?n(new Error("请输入价格")):Object(c.e)(t)?n():n(new Error("请输入最多带有两位小数的数字"))},trigger:"blur"}],totalCount:[{required:!0,message:"请输入总次数",trigger:"blur"}]}}},components:{moduleEdit:r},computed:{timestampToTime:function(){return a.l},getButtons:function(){return a.g}},mounted:function(){this.getUser();var e=this.$refs.height.offsetHeight;this.tableHeight=e-63-128-30},methods:{voucherFn:function(e){this.imgsrc=e,this.voucherShow=!0},sortList:function(e){var t="";e.order&&e.prop?(t="descending"===e.order?",desc":"ascending"===e.order?",asc":"",this.listQuery.sort=e.prop+t):this.listQuery.sort="createdAt,desc",this.getUser()},enabledF:function(e){var t=this;if(0==this.multipleSelection.length)return!1;this.multipleSelection.forEach(function(n,i){t.closeQuery={id:n.id,enabled:e},Object(a.c)(t.example,t.closeQuery).then(function(n){t.multipleSelection[i].enabled=e,i==t.multipleSelection.length-1&&t.$notify({title:"成功",message:t.enabledText[e]+"成功",type:"success",duration:2e3})})})},deleteUser:function(){var e=this;if(0==this.multipleSelection.length)return!1;this.multipleSelection.forEach(function(t,n){e.deleteQuery={id:t.id},Object(a.b)(e.example,e.deleteQuery).then(function(t){e.tableData.splice(n,1),n==e.multipleSelection.length-1&&e.$notify({title:"成功",message:"删除成功",type:"success",duration:2e3})})})},handleCreate:function(e){var t=this;this.dialogVisible=!0,this.dialogFlag=!0,this.updateTemp={},this.$nextTick(function(){t.$refs.updateForm.clearValidate()})},createDate:function(){var e=this;this.$refs.updateForm.validate(function(t){t&&Object(a.a)(e.example,e.updateTemp).then(function(t){e.dialogVisible=!1,e.resetForm("updateForm"),e.getUser(),e.$notify({title:"成功",message:"新增成功",type:"success",duration:2e3})}).catch(function(e){console.log(e)})})},handleSizeChange:function(e){this.listQuery.size=e,this.getUser()},handleCurrentChange:function(e){this.listQuery.page=e-1,this.getUser()},getUser:function(){var e=this;Object(a.d)(this.example,this.listQuery).then(function(t){e.tableData=t.data,e.tableData.forEach(function(e){if("{}"!=l()(e.files)){for(var t=e.files,n=e.files.length-1;n>=0;n--)e.files[n].fileSize<=0&&t.splice(n,1);e.files=t}}),e.total=t.total})},onSubmit:function(e){var t=this;e?this.$refs[e].validate(function(e){if(!e)return console.log("error submit!!"),!1;Object(a.d)(t.example,Object(a.f)(t.formInline)).then(function(e){t.tableData=e.data,t.total=e.total})}):(this.formInline.name="",Object(a.d)(this.example,Object(a.f)(this.formInline)).then(function(e){t.tableData=e.data,t.total=e.total}))},resetForm:function(e){this.dialogVisible=!1,this.$refs[e].resetFields()},handleSelectionChange:function(e){this.multipleSelection=e}},watch:{editFlag:function(e,t){this.getUser()}}},d={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{ref:"height",staticClass:"main",attrs:{id:"backgounduser"}},[n("div",{directives:[{name:"show",rawName:"v-show",value:!e.editFlag,expression:"!editFlag"}]},[n("el-form",{ref:"formInline",staticClass:"demo-form-inline",attrs:{inline:!0,model:e.formInline}},[n("el-form-item",{attrs:{label:"模块名称",prop:"username"}},[n("el-input",{attrs:{placeholder:"请输入模块名称"},model:{value:e.formInline.name,callback:function(t){e.$set(e.formInline,"name",t)},expression:"formInline.name"}})],1),e._v(" "),n("el-form-item",[n("el-button",{attrs:{type:"primary"},on:{click:function(t){e.onSubmit("formInline")}}},[e._v("查询")]),e._v(" "),n("el-button",{on:{click:function(t){e.onSubmit()}}},[e._v("清除")])],1),e._v(" "),n("el-form-item",{staticStyle:{float:"right"}},[e.getButtons("add")?n("el-button",{attrs:{type:"success"},on:{click:e.handleCreate}},[e._v("新增")]):e._e(),e._v(" "),e.getButtons("on")?n("el-button",{on:{click:function(t){e.enabledF(!0)}}},[e._v("启用")]):e._e(),e._v(" "),e.getButtons("off")?n("el-button",{attrs:{type:"warning"},on:{click:function(t){e.enabledF(!1)}}},[e._v("禁用")]):e._e()],1)],1),e._v(" "),n("el-table",{attrs:{data:e.tableData,height:e.tableHeight,border:""},on:{"selection-change":e.handleSelectionChange,"sort-change":e.sortList}},[n("el-table-column",{attrs:{align:"center",type:"selection",width:"100"}}),e._v(" "),n("el-table-column",{attrs:{align:"center",prop:"name",label:"模块名称",width:"250",sortable:"custom"}}),e._v(" "),n("el-table-column",{attrs:{align:"center",prop:"description",label:"模块描述",width:"250"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.description?n("span",[t.row.description.split("").length>20?n("el-popover",{attrs:{trigger:"hover",placement:"top"}},[n("p",{staticStyle:{width:"300px"}},[e._v(e._s(t.row.description))]),e._v(" "),n("div",{staticClass:"name-wrapper",attrs:{slot:"reference"},slot:"reference"},[n("el-tag",{staticStyle:{width:"200px","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis"},attrs:{size:"medium"}},[e._v(e._s(t.row.description))])],1)]):n("span",[e._v(e._s(t.row.description))])],1):n("span",[e._v("-")])]}}])}),e._v(" "),n("el-table-column",{attrs:{align:"center",prop:"price",label:"模块成本（元）",width:"150"}}),e._v(" "),n("el-table-column",{attrs:{align:"center",prop:"code",label:"code",width:"200"}}),e._v(" "),n("el-table-column",{attrs:{prop:"licensePicURL",align:"center",label:"模块图片",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[void 0!=t.row.files.length?n("el-button",{attrs:{type:"primary",icon:"el-icon-picture",circle:"true"},on:{click:function(n){e.voucherFn(t.row.files)}}}):n("span",[e._v("-")])]}}])}),e._v(" "),n("el-table-column",{attrs:{align:"center",label:"选用次数",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("span",[e._v(e._s(void 0==t.row.productionManagers.length?"0":t.row.productionManagers.length))])]}}])}),e._v(" "),n("el-table-column",{attrs:{align:"center",label:"状态",prop:"enabled",width:"150",sortable:"custom"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("span",{class:{forbidden:!t.row.enabled,normalStatus:t.row.enabled}},[e._v(e._s(1==t.row.enabled?"正常":"锁定"))])]}}])}),e._v(" "),n("el-table-column",{attrs:{align:"center",prop:"price",label:"修改时间",width:e.getButtons("edit")?200:""},scopedSlots:e._u([{key:"default",fn:function(t){return[n("span",[e._v(e._s(e.timestampToTime(t.row.lastModifiedAt)))])]}}])}),e._v(" "),e.getButtons("edit")?n("el-table-column",{attrs:{align:"center",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-button",{attrs:{size:"small",icon:"el-icon-edit",type:"text"},on:{click:function(n){e.editFlag=!0,e.moduleData=t.row}}},[e._v("编辑")])]}}])}):e._e()],1),e._v(" "),n("el-pagination",{attrs:{background:"","current-page":1,"page-sizes":[10,20,30,40],"page-size":10,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}}),e._v(" "),n("el-dialog",{attrs:{title:e.dialogText[e.dialogFlag],width:"30%",visible:e.dialogVisible},on:{"update:visible":function(t){e.dialogVisible=t}}},[n("el-form",{ref:"updateForm",staticStyle:{"max-width":"400px"},attrs:{rules:e.updateRule,model:e.updateTemp,"label-position":"right","label-width":"150px"}},[n("el-form-item",{attrs:{label:"模块名称",prop:"name"}},[n("el-input",{model:{value:e.updateTemp.name,callback:function(t){e.$set(e.updateTemp,"name",t)},expression:"updateTemp.name"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"code",prop:"code"}},[n("el-input",{model:{value:e.updateTemp.code,callback:function(t){e.$set(e.updateTemp,"code",t)},expression:"updateTemp.code"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"模块成本（元）",prop:"price"}},[n("el-input",{model:{value:e.updateTemp.price,callback:function(t){e.$set(e.updateTemp,"price",t)},expression:"updateTemp.price"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"模块描述",prop:"description"}},[n("el-input",{attrs:{type:"textarea",rows:6,"max-length":"100",placeholder:"最多输入100个字"},model:{value:e.updateTemp.description,callback:function(t){e.$set(e.updateTemp,"description",t)},expression:"updateTemp.description"}})],1)],1),e._v(" "),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(t){e.resetForm("updateForm")}}},[e._v("取 消")]),e._v(" "),n("el-button",{attrs:{type:"primary"},on:{click:e.createDate}},[e._v("确 定")])],1)],1),e._v(" "),n("el-dialog",{attrs:{title:"模块图片",visible:e.voucherShow,width:"50%",center:""},on:{"update:visible":function(t){e.voucherShow=t}}},[n("el-row",e._l(e.imgsrc,function(t,i){return n("el-col",{key:t.id,attrs:{span:(24-2*(e.imgsrc.length-1))/e.imgsrc.length,offset:0==i?0:2}},[n("el-card",{attrs:{"body-style":{padding:"0px"}}},[n("img",{staticStyle:{width:"100%"},attrs:{src:"http://"+t.url}})])],1)})),e._v(" "),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"})],1)],1),e._v(" "),n("moduleEdit",{directives:[{name:"show",rawName:"v-show",value:e.editFlag,expression:"editFlag"}],attrs:{moduleData:e.moduleData},on:{changeFlag:function(t){e.editFlag=!1}}})],1)},staticRenderFns:[]};var p=n("VU/8")(u,d,!1,function(e){n("VE/P")},"data-v-23bdc1d7",null);t.default=p.exports},"8Cpf":function(e,t,n){(e.exports=n("FZ+f")(!1)).push([e.i,"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",""])},QiUo:function(e,t,n){(e.exports=n("FZ+f")(!1)).push([e.i,"\n#backgounduser[data-v-23bdc1d7]{\n  min-height: calc(100vh - 84px - 25px);\n}\n",""])},"VE/P":function(e,t,n){var i=n("QiUo");"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);n("rjj0")("6260c618",i,!0)},a2D9:function(e,t,n){var i=n("8Cpf");"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);n("rjj0")("5514d594",i,!0)}});