webpackJsonp([2],{"6thC":function(e,t,n){(e.exports=n("FZ+f")(!1)).push([e.i,'\n.ms-tree-space[data-v-19b768a8] {\n  position: relative;\n  top: 1px;\n  display: inline-block;\n  font-style: normal;\n  font-weight: 400;\n  line-height: 1;\n  width: 18px;\n  height: 14px;\n}\n.ms-tree-space[data-v-19b768a8]::before {\n    content: "";\n}\n.processContainer[data-v-19b768a8] {\n  width: 100%;\n  height: 100%;\n}\ntable td[data-v-19b768a8] {\n  line-height: 26px;\n}\n.tree-ctrl[data-v-19b768a8] {\n  position: relative;\n  cursor: pointer;\n  color: #2196F3;\n  margin-left: -18px;\n}\n',""])},"7r6t":function(e,t,n){(e.exports=n("FZ+f")(!1)).push([e.i,"\n[v-cloak][data-v-057968c1] {\n  display: none;\n}\n",""])},"8u4J":function(e,t,n){var l=n("7r6t");"string"==typeof l&&(l=[[e.i,l,""]]),l.locals&&(e.exports=l.locals);n("rjj0")("77b34df8",l,!0)},"ACs+":function(e,t,n){(e.exports=n("FZ+f")(!1)).push([e.i,"\n@keyframes treeTableShow {\nfrom {opacity: 0;\n}\nto {opacity: 1;\n}\n}\n@-webkit-keyframes treeTableShow {\nfrom {opacity: 0;\n}\nto {opacity: 1;\n}\n}\n",""])},"E/TR":function(e,t){e.exports=function(){return Function.call.apply(Array.prototype.concat,arguments)}},EEth:function(e,t,n){var l=n("6thC");"string"==typeof l&&(l=[[e.i,l,""]]),l.locals&&(e.exports=l.locals);n("rjj0")("ffa0c3c8",l,!0)},dXij:function(e,t,n){e.exports={default:n("E/TR"),__esModule:!0}},giNx:function(e,t,n){var l=n("ACs+");"string"==typeof l&&(l=[[e.i,l,""]]),l.locals&&(e.exports=l.locals);n("rjj0")("13e76565",l,!0)},kzcA:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=n("t5DY");var a=n("vLgD");n("YaEn");var o=n("Dd8w"),i=n.n(o),s=n("dXij"),r=n.n(s),c=n("pfQ4"),u=n("IcnI"),d={name:"roleEdit",props:{id:"",editShow:"",evalFunc:Function,evalArgs:Array,expandAll:{type:Boolean,default:!1}},data:function(){return{roleData:[],childTableHeight:500,listQuery:{name:null,note:null},params:{fields:"*,buttons",page:0,size:1e3},rules:{name:[{required:!0,message:"请输入角色名称",trigger:"blur"}],code:[{required:!0,message:"请输入角色标识",trigger:"blur"}]},dataList:[],itemMenus:[],itemBtns:[],data:[],columns:[{name:"菜单名称",value:"name",width:600}],checked:!1,multipleSelection:[],checkList:[],menuSelectId:[],allMenu:[],selectIndex:[]}},computed:{},mounted:function(){},methods:{formatData:function(e){var t=void 0;this.allMenu=[],t=Array.isArray(e)?e:[e];var n=this.evalFunc||c.a,l=this.evalArgs?r()([t,this.expandAll],this.evalArgs):[t,this.expandAll];return this.allMenu=n.apply(null,l),n.apply(null,l)},handleSelectionChange:function(e){this.multipleSelection=e},showRow:function(e){return e.row._show=!0,"animation:treeTableShow 1s;-webkit-animation:treeTableShow 1s;"},toggleExpanded:function(e){var t=this.formatData[e];t._expanded=!t._expanded},iconShow:function(e,t){return 0===e&&t.children&&t.children.length>0},submitFn:function(){var e=this,t=[],n=[],a=this.id;if(this.checkList.forEach(function(e){n.push({id:e})}),0==this.multipleSelection.length)return!1;this.multipleSelection.forEach(function(e){t.push({id:e.id})});var o=i()({id:a,menus:t,buttons:n},this.listQuery);Object(l.n)("role",o).then(function(t){0===t.errorCode?(e.reform(),e.$notify.success({title:"Info",message:"编辑成功",showClose:!1}),e.$emit("changeShow")):e.$notify.error({title:"Info",message:t.errorMessage,showClose:!1})})},getData:function(){var e,t=this;"DEVELOPER"!=u.a.getters.roles[0].code&&(this.params.developerMenu=!1),(e=this.params,Object(a.a)({url:"entity/menu/tree",method:"GET",params:e})).then(function(e){t.roleData=t.formatData(e.data)}).then(function(){t.getInfo()})},getInfo:function(){var e=this,t={id:this.id,fields:"*,menus,buttons"};Object(l.h)("role",t).then(function(t){if(0===t.errorCode){e.listQuery.name=t.data.name,e.listQuery.note=t.data.note;var n=[];void 0!=t.data.buttons.length&&t.data.buttons.forEach(function(e){n.push(e.id)}),e.checkList=n,e.menuSelectId=[],void 0!=t.data.menus.length&&t.data.menus.forEach(function(t){e.menuSelectId.push(t.id)}),e.selectIndex=[],e.menuSelectId.forEach(function(t){e.allMenu.forEach(function(n,l){t!=n.id||e.selectIndex.push(l)})}),e.selectIndex.forEach(function(t){e.$refs.multipleTable.toggleRowSelection(e.allMenu[t],!0)})}})},reform:function(){var e=this;this.checkList=[],this.selectIndex.forEach(function(t){e.$refs.multipleTable.toggleRowSelection(e.allMenu[t],!1)}),this.selectIndex=[]}},watch:{editShow:function(e,t){if(1==e){var n=this.$refs.childHeight.offsetHeight;this.childTableHeight=n-63-140-30,console.log(n),console.log(this.childTableHeight),this.getData()}}}},h={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{ref:"childHeight",staticClass:"main",attrs:{id:"menuManagement"}},[n("el-form",{ref:"listQuery",staticClass:"demo-form-inline",attrs:{inline:!0,model:e.listQuery}},[n("el-form-item",{attrs:{label:"角色名称",prop:"name"}},[n("el-input",{attrs:{placeholder:"请输入角色名称"},model:{value:e.listQuery.name,callback:function(t){e.$set(e.listQuery,"name",t)},expression:"listQuery.name"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"备注",prop:"node"}},[n("el-input",{attrs:{placeholder:"请输入备注"},model:{value:e.listQuery.note,callback:function(t){e.$set(e.listQuery,"note",t)},expression:"listQuery.note"}})],1)],1),e._v(" "),n("el-table",e._b({ref:"multipleTable",attrs:{data:e.roleData,"row-style":e.showRow,border:"",height:e.childTableHeight},on:{"selection-change":e.handleSelectionChange}},"el-table",e.$attrs,!1),[n("el-table-column",{attrs:{align:"center",type:"selection",width:"100"}}),e._v(" "),0===e.columns.length?n("el-table-column",{attrs:{width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._l(t.row._level,function(e){return n("span",{key:e,staticClass:"ms-tree-space"})}),e._v(" "),e.iconShow(0,t.row)?n("span",{staticClass:"tree-ctrl",on:{click:function(n){e.toggleExpanded(t.$index)}}},[t.row._expanded?n("i",{staticClass:"el-icon-minus"}):n("i",{staticClass:"el-icon-plus"})]):e._e(),e._v("\n        "+e._s(t.$index)+"\n      ")]}}])}):e._l(e.columns,function(t,l){return n("el-table-column",{key:t.name,attrs:{label:t.name,width:t.width},scopedSlots:e._u([{key:"default",fn:function(t){return[e._l(t.row._level,function(t){return 0===l?n("span",{key:t,staticClass:"ms-tree-space"}):e._e()}),e._v(" "),e.iconShow(l,t.row)?n("span",{staticClass:"tree-ctrl",on:{click:function(n){e.toggleExpanded(t.$index)}}},[t.row._expanded?n("i",{staticClass:"el-icon-minus"}):n("i",{staticClass:"el-icon-plus"})]):e._e(),e._v("\n        "+e._s(t.row.name)+"\n      ")]}}])})}),e._v(" "),n("el-table-column",{attrs:{align:"left",label:"按钮权限"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-checkbox-group",{staticClass:"checkgroup",model:{value:e.checkList,callback:function(t){e.checkList=t},expression:"checkList"}},[e._l(t.row.buttons,function(t){return[n("el-checkbox",{key:t.id,attrs:{label:t.id}},[e._v(e._s(t.name))])]})],2)]}}])}),e._v(" "),e._t("default")],2),e._v(" "),n("el-row",{staticStyle:{margin:"50px 0"},attrs:{type:"flex",justify:"center"}},[n("el-button",{on:{click:function(t){e.$emit("changeShow"),e.reform()}}},[e._v("返回")]),e._v(" "),n("el-button",{attrs:{type:"primary"},on:{click:e.submitFn}},[e._v("保存")])],1)],1)},staticRenderFns:[]};var f={name:"role-management",data:function(){return{tableHeight:500,tableData:[],dialogVisible:!1,listQuery:{page:0,size:10,name:null,code:null,fields:"*,users,note"},total:0,temp:{},rules:{name:[{required:!0,message:"请输入角色名称",trigger:"blur"}],code:[{required:!0,message:"请输入角色标识",trigger:"blur"}]},dialogTitle:"",multipleSelection:[],roleID:"",editShow:!1}},computed:{timestampToTime:function(){return l.l},getButtons:function(){return l.g}},mounted:function(){this.getRole();var e=this.$refs.height.offsetHeight;this.tableHeight=e-63-128-30},components:{roleEdit:n("VU/8")(d,h,!1,function(e){n("giNx"),n("EEth")},"data-v-19b768a8",null).exports},methods:{getRole:function(){var e,t=this;(e=this.listQuery,Object(a.a)({url:"entity/role/list",method:"GET",params:e})).then(function(e){t.tableData=[];var n=0,l=!1;t.$store.getters.roles.forEach(function(e){if("DEVELOPER"==e.code)return l=!0,!1}),l?(t.tableData=e.data,t.total=e.total):(e.data.forEach(function(e){console.log(e.code),"DEVELOPER"!=e.code&&"GUEST"!=e.code&&"ANONYMOUS"!=e.code&&(t.tableData.push(e),n++)}),t.total=n)})},resetForm:function(e){e.name=null,e.code=null,this.getRole()},handleSizeChange:function(e){this.listQuery.size=e,this.getRole()},handleCurrentChange:function(e){this.listQuery.page=e-1,this.getRole()},handleDelete:function(){var e=this;this.multipleSelection.length>0?function(e){return Object(a.a)({url:"batch/role/batchDelete",method:"POST",data:{ids:e}})}(function(e){var t=[];for(var n in e)t.push(e[n].id);return console.log(t),t}(this.multipleSelection)).then(function(t){0===t.errorCode?(e.$notify.success({title:"消息",message:"删除成功",showClose:!1,duration:2e3}),e.getRole()):e.$notify.error({title:"消息",message:t.errorMessage,showClose:!1,duration:2e3})}).catch(function(){e.$message({type:"消息",message:"已取消删除",duration:2e3})}):this.$notify.error({title:"消息",message:"请选择需要删除的角色",duration:2e3,showClose:!1})},handleCreate:function(e){this.dialogTitle=e,this.dialogVisible=!0},handleSelectionChange:function(e){this.multipleSelection=e},createDate:function(e){var t=this;this.$refs[e].validate(function(e){var n,l;e&&("新增角色"===t.dialogTitle?(l=t.temp,Object(a.a)({url:"entity/role/create",method:"POST",data:l})).then(function(e){0===e.errorCode&&(t.dialogVisible=!1,t.temp={},t.$notify.success({title:"消息",message:"新增成功",showClose:!1}),t.getRole())}).catch(function(e){console.log(e)}):"编辑角色"===t.dialogTitle&&(n=t.temp,Object(a.a)({url:"entity/role/update",method:"POST",data:n})).then(function(e){0===e.errorCode&&(t.dialogVisible=!1,t.temp={},t.$notify.success({title:"消息",message:"编辑成功",showClose:!1}),t.getRole())}).catch(function(e){console.log(e)}))})}},watch:{dialogVisible:function(e,t){e!==t&&this.$refs.dataForm.resetFields()},editShow:function(e,t){e||(u.a.dispatch("GetInfo").then(function(e){window.myinfo=e.data}),this.getRole())}}},m={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[e.editShow?e._e():n("div",{ref:"height",staticClass:"main"},[n("div",{attrs:{id:"backgounduser"}},[n("el-form",{ref:"listQuery",staticClass:"demo-form-inline",attrs:{inline:!0,model:e.listQuery}},[n("el-form-item",{attrs:{label:"角色名称",prop:"name"}},[n("el-input",{attrs:{placeholder:"请输入角色名称"},model:{value:e.listQuery.name,callback:function(t){e.$set(e.listQuery,"name",t)},expression:"listQuery.name"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"角色标识",prop:"name"}},[n("el-input",{attrs:{placeholder:"请输入角色标识"},model:{value:e.listQuery.code,callback:function(t){e.$set(e.listQuery,"code",t)},expression:"listQuery.code"}})],1),e._v(" "),n("el-form-item",[n("el-button",{attrs:{type:"primary"},on:{click:e.getRole}},[e._v("查询")]),e._v(" "),n("el-button",{on:{click:function(t){e.resetForm(e.listQuery)}}},[e._v("清除")])],1),e._v(" "),n("el-form-item",{staticStyle:{float:"right"}},[e.getButtons("add")?n("el-button",{attrs:{type:"success"},on:{click:function(t){e.handleCreate("新增角色")}}},[e._v("新增")]):e._e(),e._v(" "),e.getButtons("delete")?n("el-button",{attrs:{type:"danger"},on:{click:e.handleDelete}},[e._v("删除")]):e._e()],1)],1),e._v(" "),n("el-table",{attrs:{data:e.tableData,border:"",height:e.tableHeight},on:{"selection-change":e.handleSelectionChange}},[n("el-table-column",{attrs:{align:"center",type:"selection",width:"55"}}),e._v(" "),n("el-table-column",{attrs:{align:"center",prop:"name",label:"角色名称"}}),e._v(" "),n("el-table-column",{attrs:{align:"center",prop:"code",label:"角色标识"}}),e._v(" "),n("el-table-column",{attrs:{align:"center",label:"授权用户"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("span",[e._v(e._s(t.row.users.length>0?t.row.users.length:"0"))])]}}])}),e._v(" "),n("el-table-column",{attrs:{align:"center",prop:"note",label:"备注"}}),e._v(" "),n("el-table-column",{attrs:{align:"center",label:"创建时间",width:e.getButtons("edit")?200:""},scopedSlots:e._u([{key:"default",fn:function(t){return[n("span",[e._v(e._s(e.timestampToTime(t.row.createdAt)))])]}}])}),e._v(" "),n("el-table-column",{attrs:{align:"center",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.getButtons("edit")?n("el-button",{attrs:{size:"small",icon:"el-icon-edit",type:"text"},on:{click:function(n){e.editShow=!0,e.roleID=t.row.id}}},[e._v("编辑")]):e._e()]}}])})],1),e._v(" "),n("el-pagination",{attrs:{background:"","current-page":1,"page-sizes":[10,20,30,40],"page-size":10,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}}),e._v(" "),n("el-dialog",{attrs:{title:e.dialogTitle,visible:e.dialogVisible,width:"30%"},on:{"update:visible":function(t){e.dialogVisible=t}}},[n("el-form",{ref:"dataForm",staticStyle:{"max-width":"400px"},attrs:{rules:e.rules,model:e.temp,"label-position":"right","label-width":"100px"}},[n("el-form-item",{attrs:{label:"角色名称",prop:"name"}},[n("el-input",{model:{value:e.temp.name,callback:function(t){e.$set(e.temp,"name",t)},expression:"temp.name"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"角色标识",prop:"code"}},[n("el-input",{model:{value:e.temp.code,callback:function(t){e.$set(e.temp,"code",t)},expression:"temp.code"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"备注",prop:"note"}},[n("el-input",{model:{value:e.temp.note,callback:function(t){e.$set(e.temp,"note",t)},expression:"temp.note"}})],1)],1),e._v(" "),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")]),e._v(" "),n("el-button",{attrs:{type:"primary"},on:{click:function(t){e.createDate("dataForm")}}},[e._v("确 定")])],1)],1)],1)]),e._v(" "),n("roleEdit",{directives:[{name:"show",rawName:"v-show",value:e.editShow,expression:"editShow"}],attrs:{id:e.roleID,editShow:e.editShow},on:{changeShow:function(t){e.editShow=!1}}})],1)},staticRenderFns:[]};var p=n("VU/8")(f,m,!1,function(e){n("8u4J")},"data-v-057968c1",null);t.default=p.exports},pfQ4:function(e,t,n){"use strict";t.a=function e(t,n){var l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;var s=[];a()(t).forEach(function(t){void 0===t._expanded&&o.default.set(t,"_expanded",n);var a=1;if(void 0!==i&&null!==i&&(a=i+1),o.default.set(t,"_level",a),l&&o.default.set(t,"parent",l),s.push(t),t.children&&t.children.length>0){var r=e(t.children,n,t,a);s=s.concat(r)}});return s};var l=n("c/Tr"),a=n.n(l),o=n("7+uW")}});