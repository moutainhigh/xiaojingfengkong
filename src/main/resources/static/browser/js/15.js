webpackJsonp([15],{"5+Z6":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a("mvHQ"),s=a.n(i),l=a("t5DY"),n=a("E4LH"),o={name:"sowing-map-list",data:function(){return{total:0,listQuery:{page:1,sizes:[10,20,30,40],size:10},searchParams:{name:"",page:0,size:10,fields:"*,files"},tableHeight:500,example:"pictureTurns",sowingMapName:"新增轮播图",sowingMapState:!1,sowingMap:{name:""},sowingMApTable:[],selectTable:[],voucherShow:!1,imgUrl:"",addForm:{name:"",sort:1,turnType:"APP",jumpUrl:"",uploadFiles:[],clickTimes:0,turnStatus:"THESHELVES"},addFormId:"",rules:{name:[{required:!0,message:"请输入广告名称",trigger:"blur"}],sort:[{required:!0,trigger:"blur",validator:function(e,t,a){Object(n.b)(t)?a():a(new Error("只能输入数字且不能为空"))}}],turnType:[{required:!0,message:"请选择轮播类型",trigger:"blur"}],uploadFiles:[{required:!0,message:"请选择图片上传",trigger:"blur"}]},dialogVisible:!1,dialogImageUrl:""}},computed:{timestampToTime:function(){return l.l},getButtons:function(){return l.g}},mounted:function(){var e=this.$refs.height.offsetHeight;this.tableHeight=e-63-128-30,this.getSowingMapList()},methods:{onSubmit:function(){this.searchParams.name=this.sowingMap.name,this.getSowingMapList()},onClear:function(){this.sowingMap.name="",this.searchParams.name="",this.getSowingMapList()},handleSizeChange:function(e){this.searchParams.size=e,this.getSowingMapList()},handleCurrentChange:function(e){this.searchParams.page=e-1,this.getSowingMapList()},handleSelectionChange:function(e){this.selectTable=e},handleUpdate:function(e){e?(this.addFormId=e.id,this.addForm.name=e.name,this.addForm.sort=e.sort,this.addForm.turnType=e.turnType,this.addForm.jumpUrl=e.jumpUrl,"{}"!=s()(e.files)?this.addForm.uploadFiles=e.files:this.addForm.uploadFiles=[],this.sowingMapName="编辑轮播图"):(this.sowingMapName="新增轮播图",this.addFormId=""),this.sowingMapState=!0},getSowingMapList:function(){var e=this;Object(l.p)(this.example,Object(l.o)(this.searchParams,["name"])).then(function(t){e.sowingMApTable=t.data,e.sowingMApTable.forEach(function(e){if("{}"!=s()(e.files))for(var t=e.files.length-1;t>=0;t--)0==e.files[t].fileSize?e.files.splice(t,1):e.files[t].url="http://"+e.files[t].url}),e.total=t.total})},openModel:function(){var e=this;this.selectTable.forEach(function(t,a){var i={id:t.id,turnStatus:"SHELVES"};Object(l.c)(e.example,i).then(function(t){a==e.selectTable.length-1&&(e.getSowingMapList(),e.$notify({title:"成功",message:"轮播图上架成功",type:"success"}))})})},offModel:function(){var e=this;this.selectTable.forEach(function(t,a){var i={id:t.id,turnStatus:"THESHELVES"};Object(l.c)(e.example,i).then(function(t){a==e.selectTable.length-1&&(e.getSowingMapList(),e.$notify({title:"成功",message:"轮播图下架成功",type:"success"}))})})},delModel:function(){var e=this;this.selectTable.forEach(function(t,a){Object(l.b)(e.example,{id:t.id}).then(function(t){a==e.selectTable.length-1&&(e.getSowingMapList(),e.$notify({title:"成功",message:"轮播图删除成功",type:"success"}))})})},voucherFn:function(e){"{}"!=s()(e)?this.imgUrl=e[0].url:this.imgUrl="",this.voucherShow=!0},spwingMapType:function(e){return{WEB:"PC端",APP:"移动端"}[e]},spwingMapStatus:function(e){return{SHELVES:"上架中",THESHELVES:"下架中"}[e]},cancelData:function(){this.resetForm(),this.sowingMapState=!1},saveData:function(){var e=this;this.$refs.form.validate(function(t){if(t)if(e.addForm.uploadFiles[0]=Object(l.j)(e.addForm.uploadFiles[0],["uid","status"]),e.addForm.uploadFiles[0].url=e.addForm.uploadFiles[0].url.substr(7),"新增轮播图"==e.sowingMapName)console.log(e.addForm),Object(l.a)(e.example,Object(l.j)(e.addForm,["id"])).then(function(t){e.getSowingMapList(),e.resetForm(),e.sowingMapState=!1,e.$notify({title:"成功",message:"轮播图新增成功",type:"success"})});else{var a=e.addForm;a.id=e.addFormId,a.uploadFiles[0].id&&(a.uploadFiles[0]={imgId:a.uploadFiles[0].id}),Object(l.m)(e.example,a).then(function(t){e.getSowingMapList(),e.resetForm(),e.sowingMapState=!1,e.$notify({title:"成功",message:"轮播图编辑成功",type:"success"})})}else e.$notify({title:"提示",message:"信息没有停写完整。",type:"warning"})})},uploadSuccess:function(e){e.data.url="http://"+e.data.url,this.addForm.uploadFiles.push(e.data),console.log(e),this.$refs.form.validateField("uploadFiles",function(e){})},handlePictureCardPreview:function(e){this.dialogImageUrl=e.url,this.dialogVisible=!0},fileRemove:function(e,t){var a=this;this.addForm.uploadFiles=[],e.id&&Object(l.b)("pictureTurnsFile",{id:e.id}).then(function(e){a.$message({type:"success",message:"图片删除成功!"})})},resetForm:function(){this.$refs.form.resetFields(),this.$refs.upload.clearFiles()}}},r={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{ref:"height",staticClass:"main"},[a("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0,model:e.sowingMap}},[a("el-form-item",{attrs:{label:"广告名称"}},[a("el-input",{attrs:{placeholder:"请输入名称"},model:{value:e.sowingMap.name,callback:function(t){e.$set(e.sowingMap,"name",t)},expression:"sowingMap.name"}})],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:e.onSubmit}},[e._v("查询")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.onClear}},[e._v("清除")])],1),e._v(" "),a("el-form-item",{staticClass:"right"},[e.getButtons("add")?a("el-button",{attrs:{type:"success"},on:{click:function(t){e.handleUpdate(!1)}}},[e._v("新增")]):e._e(),e._v(" "),e.getButtons("delete")?a("el-button",{attrs:{type:"danger"},on:{click:e.delModel}},[e._v("删除")]):e._e(),e._v(" "),e.getButtons("grounding")?a("el-button",{attrs:{type:"primary"},on:{click:e.openModel}},[e._v("上架")]):e._e(),e._v(" "),e.getButtons("undercarriage")?a("el-button",{attrs:{type:"primary"},on:{click:e.offModel}},[e._v("下架")]):e._e()],1)],1),e._v(" "),a("el-table",{ref:"multipleTable",staticStyle:{width:"100%"},attrs:{height:e.tableHeight,border:"",data:e.sowingMApTable,"tooltip-effect":"dark"},on:{"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection",width:"55"}}),e._v(" "),a("el-table-column",{attrs:{label:"广告名称",align:"center",prop:"name"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.name))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"轮播排序",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.sort))])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"licensePicURL",align:"center",label:"广告图片"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"primary",icon:"el-icon-picture",circle:"true"},on:{click:function(a){e.voucherFn(t.row.files)}}})]}}])}),e._v(" "),a("el-table-column",{attrs:{align:"center",label:"创建时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(e.timestampToTime(t.row.createdAt)))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"轮播类型",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(e.spwingMapType(t.row.turnType)))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"状态",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(e.spwingMapStatus(t.row.turnStatus)))])]}}])}),e._v(" "),a("el-table-column",{attrs:{align:"center",label:"点击次数"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.clickTimes))]}}])}),e._v(" "),e.getButtons("edit")?a("el-table-column",{attrs:{align:"center",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{size:"small",icon:"el-icon-edit",type:"text"},on:{click:function(a){e.handleUpdate(t.row)}}},[e._v("编辑")])]}}])}):e._e()],1),e._v(" "),a("el-pagination",{attrs:{background:"","current-page":e.listQuery.page,"page-sizes":e.listQuery.sizes,"page-size":e.listQuery.size,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}}),e._v(" "),a("el-dialog",{attrs:{title:"广告图片",visible:e.voucherShow,width:"50%",center:""},on:{"update:visible":function(t){e.voucherShow=t}}},[a("img",{staticStyle:{width:"100%"},attrs:{alt:"没有图片或图片已经损坏",src:e.imgUrl}}),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"})]),e._v(" "),a("el-dialog",{attrs:{title:e.sowingMapName,visible:e.sowingMapState,width:"500px"},on:{"update:visible":function(t){e.sowingMapState=t},close:e.resetForm}},[a("el-form",{ref:"form",staticClass:"demo-form-inline",attrs:{rules:e.rules,model:e.addForm,"label-width":"120px"}},[a("el-form-item",{attrs:{label:"广告名称",prop:"name"}},[a("el-input",{staticClass:"width",attrs:{placeholder:"请输入名称"},model:{value:e.addForm.name,callback:function(t){e.$set(e.addForm,"name",t)},expression:"addForm.name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"广告序号",prop:"sort"}},[a("el-input",{staticClass:"width",attrs:{placeholder:"请输入广告序号"},model:{value:e.addForm.sort,callback:function(t){e.$set(e.addForm,"sort",t)},expression:"addForm.sort"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"轮播类型",prop:"turnType"}},[a("el-select",{staticClass:"width",attrs:{placeholder:"请选择轮播类型"},model:{value:e.addForm.turnType,callback:function(t){e.$set(e.addForm,"turnType",t)},expression:"addForm.turnType"}},[a("el-option",{attrs:{label:"PC端",value:"WEB"}}),e._v(" "),a("el-option",{attrs:{label:"移动端",value:"APP"}})],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"广告链接",prop:"jumpUrl"}},[a("el-input",{staticClass:"width",attrs:{placeholder:"请输入广告链接"},model:{value:e.addForm.jumpUrl,callback:function(t){e.$set(e.addForm,"jumpUrl",t)},expression:"addForm.jumpUrl"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"上传广告图片",prop:"uploadFiles"}},[a("el-upload",{ref:"upload",attrs:{limit:1,"file-list":e.addForm.uploadFiles,action:"fileUpload","list-type":"picture-card","on-preview":e.handlePictureCardPreview,"on-success":e.uploadSuccess,"on-remove":e.fileRemove}},[a("i",{staticClass:"el-icon-plus"})])],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.cancelData}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.saveData}},[e._v("确 定")])],1)],1),e._v(" "),a("el-dialog",{attrs:{visible:e.dialogVisible},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("img",{attrs:{width:"100%",src:e.dialogImageUrl,alt:""}})])],1)},staticRenderFns:[]};var c=a("VU/8")(o,r,!1,function(e){a("NOHT")},"data-v-6cc1cbf2",null);t.default=c.exports},J1uE:function(e,t,a){(e.exports=a("FZ+f")(!1)).push([e.i,"\n.main .right[data-v-6cc1cbf2] {\n  float: right;\n  margin-right: 20px;\n}\n.main .right[data-v-6cc1cbf2]:after {\n  clear: both;\n}\n.main .width[data-v-6cc1cbf2] {\n  width: 300px;\n}\n",""])},NOHT:function(e,t,a){var i=a("J1uE");"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);a("rjj0")("09c29c96",i,!0)}});